#==============================================================================
# 1. 基础设置 (Basic Options)
#==============================================================================

# 设置默认终端类型，确保颜色和功能正常
set -g default-terminal "tmux-256color"
# 启用真彩色支持
set-option -sa terminal-overrides ",xterm*:Tc"

# 禁止程序（如 Shell）自动重命名 tmux 窗口标题
set-option -g allow-rename off

# 开启鼠标支持
set -g mouse on

# 增加历史记录缓冲区大小
set -g history-limit 10000

# 窗口和面板的索引从 1 开始
set -g base-index 1
setw -g pane-base-index 1

# 关闭窗口时自动重新编号
set -g renumber-windows on

# 减少 Esc 键的延迟
set -sg escape-time 0


#==============================================================================
# 2. 快捷键绑定 (Keybindings)
#==============================================================================

# --- 前缀键设置 ---
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# 【最终修复】将 C-l 绑定为向面板发送 C-l 键码，确保清屏功能正常
bind C-l send-keys C-l

# --- 常用操作 ---
bind r source-file ~/.config/tmux/tmux.conf \; display "配置已重新加载！"

# --- 面板操作 (Panes) ---
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind -r h select-pane -L
bind -r j select-pane -D
bind -r k select-pane -U
bind -r l select-pane -R
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# --- 窗口操作 (Windows) ---
bind c new-window -c "#{pane_current_path}"
bind x kill-pane
bind & kill-window
bind p previous-window
bind n next-window
bind w choose-window

# --- Vim 复制模式 ---
setw -g mode-keys vi
bind [ copy-mode
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind P paste-buffer


#==============================================================================
# 3. 外观配置 (Appearance)
#==============================================================================

set -g status-position bottom
set -g status-justify left
set -g pane-border-style "fg=colour238"
set -g pane-active-border-style "fg=colour51"
set -g message-style "bg=colour238,fg=colour223"


#==============================================================================
# 4. TPM 插件管理器 (Plugin Manager)
#==============================================================================

set-environment -g TMUX_PLUGIN_MANAGER_PATH "$HOME/.local/share/tmux/plugins/"

if "test ! -d $HOME/.local/share/tmux/plugins/tpm" \
   "run 'mkdir -p $HOME/.local/share/tmux/plugins && git clone https://github.com/tmux-plugins/tpm $HOME/.local/share/tmux/plugins/tpm && $HOME/.local/share/tmux/plugins/tpm/bin/install_plugins'"

# --- 插件列表 ---
# 基础插件
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'jaclu/tmux-menus'

set -g @menus_trigger 'Space'

set -g @plugin '2kabhishek/tmux2k'
set -g @tmux2k-theme 'onedark'
set -g @tmux2k-icons-only true
set -g @tmux2k-show-powerline false


set -g @tmux2k-left-plugins "session git cpu ram"
set -g @tmux2k-right-plugins "battery network time"

# 功能性插件
# set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-resurrect'

# nerd-font 插件，依然放在最后，确保它能覆盖主题的窗口名称部分
set -g @plugin 'joshmedeski/tmux-nerd-font-window-name'

# --- 初始化 TPM ---
# ！！！这一行必须在配置文件的最后！！！
run "$HOME/.local/share/tmux/plugins/tpm/tpm"
