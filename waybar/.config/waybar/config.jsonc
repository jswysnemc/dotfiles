{
    // ==============================================================================
    // 全局配置 (Global Configuration)
    // ==============================================================================
    "layer": "top",           // 顶层显示，防止被窗口遮挡
    "position": "top",        // 位置：顶部
    "height": 24,             // 高度：稍微增加一点以容纳图标，24有点挤
    "spacing": 4,             // 模块间距：给予少量间距，避免过于拥挤
    "reload_style_on_change": true, // 修改CSS后自动重载

    // ==============================================================================
    // 模块布局 (Module Layout)
    // ==============================================================================

    // 左侧：Logo -> 工作区 -> 快捷启动 -> AI工具 -> 任务栏
    "modules-left": [
        "custom/arch",
        "custom/separator-line",
        "niri/workspaces",
        "custom/separator-line",
        "group/quick-start",
        "custom/separator-arrow",
        "group/ai-drawer",
        "custom/separator-line",
        "group/shot-recoder",
        "wlr/taskbar"
    ],

    // 中间：当前窗口标题
    "modules-center": [
        "niri/window"
    ],

    // 右侧：硬件监控 -> 网络 -> 蓝牙 -> 音频 -> 亮度 -> 电池 -> 抑制休眠 -> 时间 -> 托盘 -> 电源
    "modules-right": [
        "custom/swaync",
        "group/hardware",     // CPU/内存/温度
        "network",            // 网络
        "bluetooth",          // 蓝牙
        "group/audio",        // 音量
        "group/g-backlight",    // 屏幕亮度 (原 ddcutil)
        "group/tools",        // 新增：咖啡 + 性能 (合并药丸)
        "battery",            // 电池
        "clock",              // 时钟
        "custom/mihomo",              // 切换mihomo模式
        "tray",               // 托盘
        "group/power"         // 电源菜单
    ],


    // ==============================================================================
    // 模块详情配置 (Module Configurations)
    // ==============================================================================

    // --- Logo / 启动器 ---
    "custom/arch": {
        "format": "",
        "tooltip": false,
        "on-click": "LANG=zh_CN.UTF-8 nwg-drawer",
        "on-click-right": "killall waybar ; waybar"
    },

    // --- 装饰性分隔符 ---
    "custom/separator-arrow": {
        "format": "󱋱",
        "tooltip": false
    },
    "custom/separator-line": {
        "format": "",
        "tooltip": false
    },


    // --- Niri 工作区 ---
    "niri/workspaces": {
        "format": "{index}",
        "format-icons": {}
    },


    // --- 快捷启动组 (Quick Start) ---
    "group/quick-start": {
        "orientation": "horizontal",
        "modules": ["custom/app-file", "custom/app-browser", "custom/app-term"]
    },
    "custom/app-file": {
        "format": "",
        "tooltip-format": "文件管理器 (Dolphin)",
        "on-click": "dolphin"
    },
    "custom/app-browser": {
        "format": "",
        "tooltip-format": "火狐浏览器 (Firefox)",
        "on-click": "firefox"
    },
    "custom/app-term": {
        "format": "",
        "tooltip-format": "终端 (Kitty)",
        "on-click": "kitty"
    },


    // --- AI 工具抽屉 (AI Drawer) ---
    "group/ai-drawer": {
        "orientation": "horizontal",
        "drawer": {
            "transition-duration": 500,
            "children-class": "child-ai",
            "transition-left-to-right": true
        },
        "modules": [
            "custom/ai-main",
            "custom/ai-gpt",
            "custom/ai-gemini",
            "custom/ai-aistudio",
            "custom/ai-deepseek"
        ]
    },
    "custom/ai-main": { "format": "", "tooltip-format": "AI 助手集合" },
    "custom/ai-gpt": { "format": "GPT", "on-click": "xdg-open https://chatgpt.com" },
    "custom/ai-gemini": { "format": "Gemini", "on-click": "xdg-open https://gemini.google.com" },
    "custom/ai-aistudio": { "format": "Ai-studio", "on-click": "xdg-open https://aistudio.google.com" },
    "custom/ai-deepseek": { "format": "DeepSeek", "on-click": "xdg-open https://chat.deepseek.com" },


    //截图
    "group/shot-recoder": {
        "orientation": "horizontal",
        "modules": ["custom/screenshot", "custom/wfrec"]
    },
   "custom/screenshot" :{
    "format": "",
    "tooltip-format": "Click to easy Screenshot Right Click to power screenshot Middle Click to longshot",
    "on-click":"~/.config/waybar/scripts/screenshot.sh",
    "on-click-right": "~/.config/waybar/scripts/power-screenshot.sh",
    "on-click-middle":"~/.config/waybar/scripts/longshot.sh"
  },
  //wf-recorder
  "custom/wfrec": {
  "exec": "~/.config/waybar/scripts/wf-recorder.sh status-json",
  "return-type": "json",
  "interval": 1,                 // 每秒刷新一次
  "signal": 9,                   // 与脚本里的 WAYBAR_SIG 对应
  "tooltip": true,
  "on-click": "~/.config/waybar/scripts/wf-recorder.sh toggle",  // 左键：开始/停止
  "on-click-right": "~/.config/waybar/scripts/wf-recorder.sh stop"
  },


    // --- Niri 任务栏 (Taskbar) ---
    // 注意：这里修复了键名，使其与 modules-left 中的引用一致
    // "wlr/niri-taskbar": {
    //     "module_path": "/usr/lib/waybar/libniri_taskbar.so",
    //     "apps": {
    //         "signal": [
    //             {
    //                 "match": "\\([0-9]+\\)$",
    //                 "class": "unread"
    //             }
    //         ]
    //     },
    //     "icon-size": 18,
    //     "on-click": "activate",
    //     "on-click-middle": "close"
    // },


    // 备用标准任务栏 (已注释)
    "wlr/taskbar": {
        "format": "{icon}",
        "icon-size": 14,
        "tooltip-format": "{title}",
        "on-click": "activate",
        "on-click-middle": "close",
        "ignore-list": ["wofi", "waybar"]
    },


    // --- 窗口标题与控制 (Window) ---
    "niri/window": {
        "format": "{title}",
        "max-length": 50,        // 稍微增加长度限制
        "separate-outputs": true,
        "rewrite": {
            "(.*) - Mozilla Firefox": "Firefox  ",
            "(.*) - Visual Studio Code": "VSCode 󰨞 ",
            "(.*) - Terminal": ">_ Term ",
            "(.*) - Dolphin": "Files  "
        },
        // 左键：切换 浮动/平铺 模式
        "on-click": "niri msg action toggle-window-floating",
        // 中键：关闭当前窗口
        "on-click-middle": "niri msg action close-window",
        // 右键：切换预设列宽
        "on-click-right": "niri msg action switch-preset-column-width"
    },


    // ==================== 硬件监控组 (Hardware) ====================
    "group/hardware": {
        "orientation": "inherit",
        "modules": [
            "cpu",
            "temperature",
            "memory"
        ]
    },
    "cpu": {
        "format": "  {usage}%",
        "interval": 2,
        "on-click": "kitty -e btop"
    },
    // 温度组件：利用 format-critical 配合 CSS 变色
    "temperature": {
        "interval": 2, // 刷新快一点
        "tooltip": true,
        "hwmon-path": [
            "/sys/class/hwmon/hwmon1/temp1_input",
            "/sys/class/thermal/thermal_zone0/temp"
        ],
        "critical-threshold": 80, // 超过80度变红
        "format-critical": "{icon} {temperatureC}°C",
        "format": "{icon} {temperatureC}°C",
        "format-icons": ["", "", ""] // 温度计图标随温度变化
    },
    "memory": {
        "format": " {percentage}%",
        "interval": 5,
        "on-click": "kitty -e btop"
    },


    // --- 网络模块 (Network) ---
    "network": {
        "interval": 1,
        // 使用 Pango 语法分别给下载(淡黄)和上传(淡绿)上色，箭头用 Nerd Font
        "format-wifi": "{icon} <span color='#fab387'>↓{bandwidthDownBytes}</span> <span color='#a6e3a1'>↑{bandwidthUpBytes}</span>",
        "format-ethernet": "󰈀 <span color='#fab387'>↓{bandwidthDownBytes}</span> <span color='#a6e3a1'>↑{bandwidthUpBytes}</span>",
        "format-disconnected": "󰤮",
        "tooltip-format": "{essid} ({signalStrength}%)\nIP: {ipaddr}",
        "format-icons": ["󰤯", "󰤟", "󰤢", "󰤥", "󰤨"],
        // "on-click": "nmtui",
        "on-click": "~/.config/waybar/scripts/wifi.sh"
    },

    // --- 蓝牙模块 (Bluetooth) ---
    "bluetooth": {
        "format": "",
        "format-disabled": "󰂳",
        "format-connected": "󰂱 {num_connections}",
        "tooltip-format": " {device_alias}",
        "tooltip-format-connected": "{device_enumerate}",
        "tooltip-format-enumerate-connected": " {device_alias} 󰂄{device_battery_percentage}%",
        "on-click": "blueman-manager",
        //"on-click": "pkill -f 'POPUP_TYPE=bluetooth' || POPUP_TYPE=bluetooth quickshell -c ~/.config/quickshell"
    },


    // ==================== 多媒体与控制 (Media & Control) ====================

    // --- 音量控制组 (Audio) ---
    "group/audio": {
        "orientation": "inherit",
        "drawer": {
            "transition-left-to-right": false
        },
        "modules": ["pulseaudio", "pulseaudio/slider"]
    },
    "pulseaudio": {
        "format": "{icon} {volume}%",
        "format-bluetooth": "{icon} {volume}%",
        "format-muted": " Muted",
        "format-icons": {
            "headphone": "",
            "hands-free": "",
            "headset": "",
            "phone": "",
            "portable": "",
            "car": "",
            "default": ["", "", ""]
        },
        "scroll-step": 5,
        "on-click": "wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle",
        "on-click-right": "pavucontrol", // 右键打开控制面板更符合习惯
        "on-scroll-up": "wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%+",
        "on-scroll-down": "wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-"
    },
    "pulseaudio/slider": {
        "min": 0,
        "max": 100,
        "orientation": "horizontal"
    },


    // --- 背光控制组 (Backlight) ---
    "group/g-backlight": {
        "orientation": "inherit",
        "drawer": {
            "transition-left-to-right": false
        },
        "modules": [
            "backlight",
            "backlight/slider"
        ]
    },
    "backlight": {
        "device": "intel_backlight", // 如果不工作，尝试删除此行自动检测
        "format": "{icon} {percent}%",
        "format-icons": ["", "", "", "", "", "", "", "", ""],
        "tooltip": false
    },
    "backlight/slider": {
        "min": 5,
        "max": 100,
        "orientation": "horizontal"
    },



    //==================== 新增：工具组 (Tools) ====================
    "group/tools": {
        "orientation": "inherit",
        "modules": [
            "idle_inhibitor",
            "power-profiles-daemon"
        ]
    },
    // --- 抑制休眠 (Idle Inhibitor) ---
    "idle_inhibitor": {
        "format": "{icon}",
        "format-icons": {
            "activated": "󰅶",      // 激活：常亮（咖啡）
            "deactivated": "󰾪"     // 未激活：省电（空杯）
        },
        "tooltip-format-activated": "咖啡模式：屏幕常亮",
        "tooltip-format-deactivated": "省电模式：自动息屏"
    },
    //左键循环切换性能模式
    "power-profiles-daemon": {
        "format": "{icon}",
        "tooltip-format": "Performance mode:{profile}",
        "tooltip": true,
        "format-icons": {
        "performance": "",
        "balanced": "",
        "power-saver": "",
        },
    },


    // --- 电池 (Battery) ---
    "battery": {
        "interval": 10,
        "states": {
            "warning": 30,
            "critical": 15
        },
        "format": "{icon} {capacity}%",
        "format-charging": "󰂄 {capacity}%",
        "format-plugged": " {capacity}%",
        "format-icons": ["󰂎", "󰁺", "󰁻", "󰁼", "󰁽", "󰁾", "󰁿", "󰂀", "󰂂", "󰁹"],
        "tooltip-format": "{timeTo} | Power: {power}W"
    },


    // --- 时钟 (Clock) ---
    "clock": {
        "interval": 60,
        "format": " {:%H:%M}",
        "format-alt": " {:%Y-%m-%d}",
        "tooltip-format": "<tt><small>{calendar}</small></tt>"
    },


    // -- mihomo ---

    "custom/mihomo": {
        "format": "{}",
        "return-type": "json",
        "exec": "~/.config/waybar/scripts/mihomo-toggle.sh",
        "on-click": "~/.config/waybar/scripts/mihomo-toggle.sh toggle",
        "on-click-right": "google-chrome-stable --app=\"http://127.0.0.1:9090/ui/zashboard/#/proxies\"",
        "interval": 5,
        "signal": 8
    },


    // --- 系统托盘 (Tray) ---
    "tray": {
        "icon-size": 13,
        "spacing": 8
    },

    // --- swaync 通知模块 ---
    "custom/swaync": {
    "tooltip": false,
    "format": "{icon}",
    "format-icons": {
      "notification": " <span foreground='red'><sup></sup></span>",
      "none": " ",
      "dnd-notification": " <span foreground='red'><sup></sup></span>",
      "dnd-none": " ",
      "inhibited-notification": " <span foreground='red'><sup></sup></span>",
      "inhibited-none": " ",
      "dnd-inhibited-notification": "<span foreground='red'><sup></sup></span>",
      "dnd-inhibited-none": " ",
    },
    "return-type": "json",
    "exec-if": "which swaync-client",
    "exec": "swaync-client -swb",
    "on-click": "swaync-client -t -sw",
    "on-click-right": "swaync-client -d -sw",
    "escape": true,
  },


    // --- 电源菜单组 (Power Menu) ---
    "group/power": {
        "orientation": "horizontal",
        "drawer": {
            "transition-duration": 500,
            "children-class": "child-power",
            "transition-left-to-right": false
        },
        "modules": [
            // "custom/power-icon", // 主图标
            "custom/shutdown",
            "custom/lock",
            "custom/sleep",
            "custom/logout",
            "custom/reboot",
        ]
    },
    "custom/power-icon": { "format": "", "tooltip": false },
    "custom/lock": {
        "format": "",
        "on-click": "loginctl lock-session",
        "tooltip-format": "锁定屏幕 (Lock)"
    },
    "custom/sleep": {
        "format": "󰤄",
        "on-click": "systemctl suspend",
        "tooltip-format": "睡眠 (Sleep)"
    },
    "custom/logout": {
        "format": "",
        "on-click": "niri msg action quit",
        "tooltip-format": "注销 (Logout)"
    },
    "custom/reboot": {
        "format": "",
        "on-click": "systemctl reboot",
        "tooltip-format": "重启 (Reboot)"
    },
    "custom/shutdown": {
        "format": "",
        "on-click": "systemctl poweroff",
        "tooltip-format": "关机 (Shutdown)"
    }
}
